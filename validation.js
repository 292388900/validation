/*!
 * validation.js v0.1.0
 * http://snandy.github.io/validation
 * @snandy 2013-06-16 18:06:47
 *
 */
~function(e,i,t){function n(e,i,t){if(e.length===+e.length){for(var n=0;e.length>n;n++)if(i.call(t,e[n],n,e)===!0)return}else for(var a in e)if(i.call(t,e[a],a,e)===!0)return}function a(){}function s(t){return e.jQuery?e.jQuery(t)[0]:i.getElementById(t)}function l(e){this.message=e,this.name="ValidationError"}function r(e,i){if(e){if(this.element=e.nodeName?e:s(e),!this.element)throw Error("element is not exits");this.initialize(e,i)}}function o(e){this.initialize(e)}var h=Object.prototype.toString,d={};n(["Array","Boolean","Function","Object","String","Number"],function(e){d["is"+e]=function(i){return h.call(i)==="[object "+e+"]"}});var u={textarea:1,text:2,password:3,checkbox:4,select:5,file:6},c={presence:function(e,i){var i=i||{},n=i.failureMsg||"不能为空!";return(""===e||null===e||e===t)&&c.fail(n),!0},numericality:function(e,i){var t=e,e=Number(e),i=i||{},n=i.min||0===i.min?i.min:null,a=i.max||0===i.max?i.max:null,s=i.is||0===i.is?i.is:null,l=i.notANumberMsg||"必须是数字!",r=i.notAnIntegerMsg||"必须为整数!",o=i.wrongNumberMsg||"必须为"+s+"!",h=i.tooLowMsg||"不能小于"+n+"!",d=i.tooHighMsg||"不能大于"+a+"!";switch(isFinite(e)||c.fail(l),i.onlyInteger&&(/\.0+$|\.$/.test(t+"")||e!=parseInt(e))&&c.fail(r),!0){case null!==s:e!=Number(s)&&c.fail(o);break;case null!==n&&null!==a:c.numericality(e,{tooLowMsg:h,min:n}),c.numericality(e,{tooHighMsg:d,max:a});break;case null!==n:Number(n)>e&&c.fail(h);break;case null!==a:e>Number(a)&&c.fail(d)}return!0},format:function(e,i){var e=e+"",i=i||{},t=i.failureMsg||"格式不对!",n=i.pattern||/./,a=i.negate||!1;return a||n.test(e)||c.fail(t),a&&n.test(e)&&c.fail(t),!0},email:function(e,i){var i=i||{},t=/^([^@\s]+)@((?:[-a-z0-9]+\.)+[a-z]{2,})$/i,n=i.failureMsg||"必须为一个有效的电子邮箱地址!";return c.format(e,{failureMsg:n,pattern:t}),!0},size:function(e,i){var e=e+"",i=i||{},t=i.min||0==i.min?i.min:null,n=i.max||0==i.max?i.max:null,a=i.is||0==i.is?i.is:null,s=i.wrongLengthMessage||"必须是"+a+"个字符长度!",l=i.tooShortMessage||"不能小于"+t+"个字符长度!",r=i.tooLongMessage||"不能大于"+n+"个字符长度!";switch(!0){case null!==a:e.length!=Number(a)&&c.fail(s);break;case null!==t&&null!==n:c.size(e,{tooShortMessage:l,min:t}),c.size(e,{tooLongMessage:r,max:n});break;case null!==t:e.length<Number(t)&&c.fail(l);break;case null!==n:e.length>Number(n)&&c.fail(r);break;default:throw Error("Validate::size - size(s) to validate against must be provided!")}return!0},inclusion:function(e,i){var i=i||{},t=i.failureMsg||"必须是列表中指定的元素!",n=i.caseSensitive===!1?!1:!0;if(i.allowNull&&null==e)return!0;i.allowNull||null!=e||c.fail(t);var a=i.within||[];if(!n){for(var s=[],l=0,r=a.length;r>l;++l){var o=a[l];d.isString(o)&&(o=o.toLowerCase()),s.push(o)}a=s,d.isString(e)&&(e=e.toLowerCase())}for(var h=!1,u=0,r=a.length;r>u;++u)a[u]==e&&(h=!0),i.partialMatch&&-1!=e.indexOf(a[u])&&(h=!0);return(!i.negate&&!h||i.negate&&h)&&c.fail(t),!0},exclusion:function(e,i){var i=i||{};return i.failureMsg=i.failureMsg||"不能输入列表中的元素!",i.negate=!0,c.inclusion(e,i),!0},confirmation:function(e,i){if(!i.match)throw Error("Error validating confirmation: Id of element to match must be provided");var i=i||{},t=i.failureMsg||"两次输入不一致!",n=i.match.nodeName?i.match:s(i.match);if(!n)throw Error("There is no reference with name of, or element with id of "+i.match);return e!=n.value&&c.fail(t),!0},acceptance:function(e,i){var i=i||{},t=i.failureMsg||"必须同意!";return e||c.fail(t),!0},fail:function(e){throw new l(e)}};r.massValidate=function(e){var i=!0;return n(e,function(e){var t=e.validate();i&&(i=t)}),i},r.prototype={validClass:"ZV_valid",invalidClass:"ZV_invalid",messageClass:"ZV_validation_msg",validFieldClass:"ZV_valid_field",invalidFieldClass:"ZV_invalid_field",initialize:function(e,i){this.validations=[],this.elementType=this.getType(),this.form=this.element.form;var i=i||{};this.validMsg=i.validMsg||"OK";var t=i.insertAfterWhatNode||this.element;this.insertAfterWhatNode=t.nodeType?t:s(t),this.onlyOnBlur=i.onlyOnBlur||!1,this.wait=i.wait||0,this.onlyOnSubmit=i.onlyOnSubmit||!1,this.beforeValidate=i.beforeValidate||a,this.beforeValid=i.beforeValid||a,this.onValid=i.onValid||function(){this.insertMessage(this.createMessage()),this.addFieldClass()},this.afterValid=i.afterValid||a,this.beforeInvalid=i.beforeInvalid||a,this.onInvalid=i.onInvalid||function(){this.insertMessage(this.createMessage()),this.addFieldClass()},this.afterInvalid=i.afterInvalid||a,this.afterValidate=i.afterValidate||a,this.form&&(this.formObj=o.getInstance(this.form),this.formObj.addField(this)),this.oldOnFocus=this.element.onfocus||a,this.oldOnBlur=this.element.onblur||a,this.oldOnClick=this.element.onclick||a,this.oldOnChange=this.element.onchange||a,this.oldOnKeyup=this.element.onkeyup||a;var n=this;if(this.element.onfocus=function(e){return n.doOnFocus(e),n.oldOnFocus.call(this,e)},!this.onlyOnSubmit)switch(this.elementType){case u.checkbox:this.element.onclick=function(e){return n.validate(),n.oldOnClick.call(this,e)};case u.select:case u.file:this.element.onchange=function(e){return n.validate(),n.oldOnChange.call(this,e)};break;default:this.onlyOnBlur||(this.element.onkeyup=function(e){return n.deferValidation(),n.oldOnKeyup.call(this,e)}),this.element.onblur=function(e){return n.doOnBlur(e),n.oldOnBlur.call(this,e)}}},destroy:function(){if(this.formObj&&(this.formObj.removeField(this),this.formObj.destroy()),this.element.onfocus=this.oldOnFocus,!this.onlyOnSubmit)switch(this.elementType){case u.checkbox:this.element.onclick=this.oldOnClick;case u.select:case u.file:this.element.onchange=this.oldOnChange;break;default:this.onlyOnBlur||(this.element.onkeyup=this.oldOnKeyup),this.element.onblur=this.oldOnBlur}this.validations=[],this.removeMessageAndFieldClass()},add:function(e,i){var t=this;return i=i||{},d.isString(e)&&n(e.split(" "),function(e,n){t.validations[n]={validateFunc:c[e],params:i}}),t},remove:function(e,i){var t=this.validations,a=[];return n(t,function(t){t.type!=e&&t.params!=i&&a.push(t)}),this.validations=a,this},deferValidation:function(){this.wait>=300&&this.removeMessageAndFieldClass();var e=this;this.timeout&&clearTimeout(e.timeout),this.timeout=setTimeout(function(){e.validate()},e.wait)},doOnBlur:function(e){this.focused=!1,this.validate(e)},doOnFocus:function(){this.focused=!0,this.removeMessageAndFieldClass()},getType:function(){var e=this.element,i=e.type.toUpperCase(),t=e.nodeName.toUpperCase();switch(!0){case"TEXTAREA"==t:return u.textarea;case"INPUT"==t&&"TEXT"==i:return u.text;case"INPUT"==t&&"PASSWORD"==i:return u.password;case"INPUT"==t&&"CHECKBOX"==i:return u.checkbox;case"INPUT"==t&&"FILE"==i:return u.file;case"SELECT"==t:return u.select;case"INPUT"==t:throw Error("Cannot use Validation on an "+i.toLowerCase()+" input");default:throw Error("Element must be an input, select, or textarea - "+t.toLowerCase()+" was given")}},doValidations:function(){var e=this.validations,i=e.length;this.validateFailed=!1;for(var t=0;i>t;++t){var n=e[t];if(this.validateFailed=!this.perform(n.validateFunc,n.params),this.validateFailed)return!1}return this.message=this.validMsg,!0},perform:function(e,i){switch(e){case c.presence:case c.confirmation:case c.acceptance:this.showMessageWhenEmpty=!0;break;case c.custom:i.showMessageWhenEmpty&&(this.showMessageWhenEmpty=!0)}var t=this.element,n=this.elementType,a=n===u.select?t.options[t.selectedIndex].value:t.value;if(e==c.acceptance){if(n!=u.checkbox)throw Error("Element to validate acceptance must be a checkbox");a=t.checked}var s=!0;try{e(a,i)}catch(r){if(!(r instanceof l))throw r;(""!==a||""===a&&this.showMessageWhenEmpty)&&(this.validateFailed=!0,this.message=r.message.split("\n")[0],s=!1)}finally{return s}},validate:function(){if(this.element.disabled)return!0;this.beforeValidate();var e=this.doValidations();return e?(this.beforeValid(),this.onValid(),this.afterValid(),!0):(this.beforeInvalid(),this.onInvalid(),this.afterInvalid(),!1)},enable:function(){return this.element.disabled=!1,this},disable:function(){return this.element.disabled=!0,this.removeMessageAndFieldClass(),this},createMessage:function(){var e=i.createElement("span"),t=i.createTextNode(this.message);return e.appendChild(t),e},insertMessage:function(e){if(this.removeMessage(),this.validateFailed||this.validMsg){var i=this.element.value,t=this.insertAfterWhatNode;if(this.showMessageWhenEmpty&&(this.elementType===u.checkbox||""===i)||""!==i){var n=this.validateFailed?this.invalidClass:this.validClass;e.className+=" "+this.messageClass+" "+n;var a=t.parentNode;t.nextSibling?a.insertBefore(e,t.nextSibling):a.appendChild(e)}}},addFieldClass:function(){var e=this.element,i=this.validFieldClass,t=this.invalidFieldClass;this.removeFieldClass(),this.validateFailed?-1==e.className.indexOf(t)&&(e.className+=" "+t):(this.showMessageWhenEmpty||""!=e.value)&&-1==e.className.indexOf(i)&&(e.className+=" "+i)},removeMessage:function(){for(var e,i=this.insertAfterWhatNode;i.nextSibling;){if(1===i.nextSibling.nodeType){e=i.nextSibling;break}i=i.nextSibling}e&&-1!=e.className.indexOf(this.messageClass)&&this.insertAfterWhatNode.parentNode.removeChild(e)},removeFieldClass:function(){var e=this.element.className;-1!=e.indexOf(this.invalidFieldClass)&&(this.element.className=e.split(this.invalidFieldClass).join("")),-1!=e.indexOf(this.validFieldClass)&&(this.element.className=e.split(this.validFieldClass).join(" "))},removeMessageAndFieldClass:function(){this.removeMessage(),this.removeFieldClass()}},o.instances={},o.getInstance=function(e){if(e){var i=e.nodeName?e:s(e),t=Math.random()*Math.random();return i.id||(i.id="formId_"+(""+t).replace(/\./,"")+(new Date).valueOf()),o.instances[i.id]||(o.instances[i.id]=new o(i)),o.instances[i.id]}},o.prototype={beforeValidate:a,onValid:a,onInvalid:a,afterValidate:a,initialize:function(i){this.name=i.id,this.element=i,this.fields=[],this.oldOnSubmit=this.element.onsubmit||a;var n=this;this.element.onsubmit=function(i){var a=!1;return n.beforeValidate(),n.valid=r.massValidate(n.fields),n.valid?n.onValid():n.onInvalid(),n.afterValidate(),n.valid&&(a=n.oldOnSubmit.call(this,i||e.event)!==!1),a?t:a}},addField:function(e){this.fields.push(e)},removeField:function(e){var i=[],t=this.fields;n(t,function(t){t!==e&&i.push(t)}),this.fields=i},destroy:function(e){return 0==this.fields.length||e?(this.element.onsubmit=this.oldOnSubmit,o.instances[this.name]=null,!0):!1}},"function"==typeof define&&define.amd?define("Validation",[],function(){return r}):e.Validation=r}(this,document);